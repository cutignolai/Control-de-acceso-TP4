/***************************************************************************//**
  @file     user.h
  @brief    user data base
  @author   Ignacio Cutignola
 ******************************************************************************/

/*******************************************************************************
 *                      INCLUDE HEADER FILES                                    *
 ******************************************************************************/
#include "user.h"

/*******************************************************************************
 *          CONSTANT AND MACRO DEFINITIONS USING #DEFINE                        *
 ******************************************************************************/


/*******************************************************************************
 *               ENUMERATIONS AND STRUCTURES AND TYPEDEFS                       *
 ******************************************************************************/


/*******************************************************************************
 *                  VARIABLE PROTOTYPES WITH GLOBAL SCOPE                       *
 ******************************************************************************/
User_t user1 = {{0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0}, 4};
User_t user2 = {{0, 0, 0, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 1}, 5};
User_t user3 = {{1, 2, 3, 4, 0, 0, 0, 0}, {1, 1, 4, 4}, 4};
User_t user4 = {{3, 4, 8, 9, 0, 2, 2, 3}, {2, 3, 9, 1, 0}, 5};
User_t user5 = {{1, 2, 3, 4, 5, 6, 7, 8}, {1, 2, 3, 4}, 4};

User_t all_users[] = {  {{0, 0, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 0},    4},
                        {{0, 0, 0, 0, 0, 0, 0, 1}, {0, 0, 0, 0, 1}, 5},
                        {{1, 2, 3, 4, 0, 0, 0, 0}, {1, 1, 4, 4},    4},
                        {{3, 4, 8, 9, 0, 2, 2, 3}, {2, 3, 9, 1, 0}, 5},
                        {{1, 2, 3, 4, 5, 6, 7, 8}, {1, 2, 3, 4},    4}  };
uint16_t user_num = 5;


/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/
bool arr_eq(uint8_t* arr1, uint8_t arr1_len, uint8_t * arr2, uint8_t arr2_len);
void blockUser(uint8_t id[]);

/*******************************************************************************
 * ROM CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/


/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

bool checkUser(uint8_t id[], uint8_t pass[], uint8_t pass_len)
{
    bool answer = false;

    uint8_t i;
    for(i = 0; i < user_num; i++)
    {
        if ( arr_eq(all_users[i].id, MAX_ID, id, MAX_ID) && arr_eq(all_users[i].pass, all_users[i].len, pass, pass_len) )
        {
            answer = true;
            break;
        }
    }

    return answer;

}

void blockUser(uint8_t id[]){
    uint8_t i;
    for(i = 0; i < user_num; i++){
        if (arr_eq(all_users[i].id, MAX_ID, id, MAX_ID)){
            all_users[i].pass[0] = 100;
            break;
        }
    }
}

/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

bool arr_eq(uint8_t* arr1, uint8_t arr1_len, uint8_t * arr2, uint8_t arr2_len){
	bool r = false;
	uint8_t i;
	if (arr1_len == arr2_len){
		for (i = 0; i < arr1_len; i++){
			if (*(arr1 + i) == *(arr2 + i)){
				r = true;
			} else {
				r = false;
				break;
			}
		}
	}
	return r;
}

/*******************************************************************************
 ******************************************************************************/
